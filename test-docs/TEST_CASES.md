# Email Assist 测试用例文档

## 文档信息

**项目名称**: Email Assist  
**文档版本**: 1.0  
**创建日期**: 2024-09-12  
**最后更新**: 2024-09-12  
**负责人**: 测试工程师代理  

## 目录

1. [用户认证测试用例](#用户认证测试用例)
2. [邮件分析测试用例](#邮件分析测试用例)
3. [报告生成测试用例](#报告生成测试用例)
4. [邮件过滤规则测试用例](#邮件过滤规则测试用例)
5. [工作流自动化测试用例](#工作流自动化测试用例)
6. [API集成测试用例](#api集成测试用例)
7. [性能测试用例](#性能测试用例)
8. [安全测试用例](#安全测试用例)
9. [可访问性测试用例](#可访问性测试用例)
10. [跨浏览器兼容性测试用例](#跨浏览器兼容性测试用例)

---

## 用户认证测试用例

### TC-AUTH-001: 用户成功注册
**优先级**: P0  
**测试类型**: 功能测试  
**前置条件**: 用户访问注册页面  

**测试步骤**:
1. 填写有效的邮箱地址: `newuser@example.com`
2. 填写强密码: `SecurePassword123!`
3. 填写用户全名: `New User`
4. 填写公司名称: `Test Company`
5. 点击"注册"按钮

**预期结果**:
- 注册成功，返回201状态码
- 返回用户信息和访问令牌
- 自动登录并重定向到仪表板
- 密码不出现在响应中

**测试数据**:
```json
{
  "email": "newuser@example.com",
  "password": "SecurePassword123!",
  "full_name": "New User",
  "company": "Test Company"
}
```

---

### TC-AUTH-002: 重复邮箱注册
**优先级**: P1  
**测试类型**: 负面测试  
**前置条件**: 数据库中已存在邮箱 `existing@example.com`  

**测试步骤**:
1. 使用已存在的邮箱地址进行注册
2. 填写其他有效信息
3. 点击"注册"按钮

**预期结果**:
- 返回409冲突状态码
- 显示错误信息"邮箱已存在"
- 用户停留在注册页面

---

### TC-AUTH-003: 用户成功登录
**优先级**: P0  
**测试类型**: 功能测试  
**前置条件**: 用户已注册且账户处于激活状态  

**测试步骤**:
1. 填写正确的邮箱地址
2. 填写正确的密码
3. 点击"登录"按钮

**预期结果**:
- 登录成功，返回200状态码
- 返回访问令牌和刷新令牌
- 重定向到仪表板页面
- 用户会话建立成功

---

### TC-AUTH-004: 错误凭据登录
**优先级**: P1  
**测试类型**: 负面测试  
**前置条件**: 用户访问登录页面  

**测试步骤**:
1. 填写邮箱地址: `user@example.com`
2. 填写错误密码: `wrongpassword`
3. 点击"登录"按钮

**预期结果**:
- 返回401未授权状态码
- 显示"凭据无效"错误信息
- 用户停留在登录页面
- 登录尝试次数被记录

---

### TC-AUTH-005: 令牌刷新功能
**优先级**: P1  
**测试类型**: 功能测试  
**前置条件**: 用户已登录并持有有效的刷新令牌  

**测试步骤**:
1. 发送POST请求到 `/api/v1/auth/refresh`
2. 请求体包含有效的刷新令牌

**预期结果**:
- 返回200状态码
- 返回新的访问令牌和刷新令牌
- 旧令牌被标记为无效
- 新令牌可用于API访问

---

### TC-AUTH-006: 密码重置流程
**优先级**: P1  
**测试类型**: 功能测试  
**前置条件**: 用户邮箱已注册  

**测试步骤**:
1. 访问忘记密码页面
2. 输入注册邮箱地址
3. 点击"发送重置链接"
4. 检查邮箱中的重置链接
5. 点击链接并设置新密码

**预期结果**:
- 重置邮件发送成功
- 重置链接有效且安全
- 密码更新成功
- 可使用新密码登录

---

## 邮件分析测试用例

### TC-EMAIL-001: 单个邮件情感分析
**优先级**: P0  
**测试类型**: 功能测试  
**前置条件**: 用户已登录，有访问权限  

**测试步骤**:
1. 导航到邮件分析页面
2. 点击"新建分析"按钮
3. 输入邮件内容: "Thank you so much for the excellent service!"
4. 填写发件人: `happy@customer.com`
5. 填写主题: "Thanks for great service"
6. 点击"分析"按钮

**预期结果**:
- 分析成功完成，返回200状态码
- 情感分析结果为"Positive"
- 优先级分类为"Low"或"Medium"
- 置信度分数 > 0.7
- 关键词提取包含相关词汇

**测试数据**:
```json
{
  "email_content": "Thank you so much for the excellent service!",
  "from": "happy@customer.com",
  "subject": "Thanks for great service"
}
```

---

### TC-EMAIL-002: 紧急邮件优先级识别
**优先级**: P0  
**测试类型**: 功能测试  
**前置条件**: 用户已登录，访问分析页面  

**测试步骤**:
1. 输入紧急邮件内容: "URGENT: Critical production system is down!"
2. 设置发件人: `ops@company.com`
3. 设置主题: "URGENT: Production System Down"
4. 执行分析

**预期结果**:
- 优先级识别为"High"
- 情感分析为"Negative"或"Neutral"
- 关键词包含"URGENT", "Critical"
- 置信度分数 > 0.8

---

### TC-EMAIL-003: 批量邮件分析
**优先级**: P1  
**测试类型**: 功能测试  
**前置条件**: 用户有批量分析权限  

**测试步骤**:
1. 点击"批量分析"按钮
2. 选择邮件源: "收件箱"
3. 设置日期范围: 2024-08-01 到 2024-08-31
4. 设置过滤条件: 包含"urgent", "customer"
5. 开始批量分析

**预期结果**:
- 分析队列创建成功
- 显示处理进度条
- 批量处理在预期时间内完成
- 生成批量分析汇总报告
- 处理结果准确无误

---

### TC-EMAIL-004: 多语言邮件分析
**优先级**: P2  
**测试类型**: 功能测试  
**前置条件**: 系统支持多语言分析  

**测试步骤**:
1. 输入中文邮件内容
2. 执行分析
3. 清空并输入英文邮件内容  
4. 执行分析
5. 比较分析结果

**预期结果**:
- 中英文邮件都能正确分析
- 关键词提取适合各自语言
- 情感分析结果合理
- 处理时间相近

**测试数据**:
```json
{
  "chinese_email": {
    "content": "您好，我需要关于产品功能的帮助。系统运行正常，但我有一些问题需要解决。",
    "expected_sentiment": "neutral"
  },
  "english_email": {
    "content": "Hello, I need help with the product features. The system is working fine, but I have some questions.",
    "expected_sentiment": "neutral"
  }
}
```

---

### TC-EMAIL-005: 分析结果导出
**优先级**: P1  
**测试类型**: 功能测试  
**前置条件**: 已完成邮件分析  

**测试步骤**:
1. 完成一次邮件分析
2. 点击"导出结果"按钮
3. 选择导出格式: PDF
4. 确认导出
5. 验证下载的文件

**预期结果**:
- 文件成功下载
- PDF文件格式正确
- 包含完整的分析结果
- 文件大小合理
- 内容可读性良好

---

### TC-EMAIL-006: 分析历史记录
**优先级**: P2  
**测试类型**: 功能测试  
**前置条件**: 用户有历史分析记录  

**测试步骤**:
1. 点击"分析历史"按钮
2. 查看历史记录列表
3. 点击某条历史记录
4. 查看详细信息

**预期结果**:
- 历史记录正确显示
- 记录包含时间戳、邮件内容、分析结果
- 详细信息完整准确
- 支持分页和搜索功能

---

## 报告生成测试用例

### TC-REPORT-001: 创建月度分析报告
**优先级**: P0  
**测试类型**: 功能测试  
**前置条件**: 用户有报告生成权限，系统有足够数据  

**测试步骤**:
1. 导航到报告页面
2. 点击"新建报告"
3. 选择报告类型: "邮件分析报告"
4. 设置日期范围: 2024-08-01 到 2024-08-31
5. 设置过滤条件: 发件人域名包含"company.com"
6. 选择格式: PDF
7. 启用图表显示
8. 提交创建请求

**预期结果**:
- 报告创建成功，返回201状态码
- 获得唯一的报告ID
- 报告状态为"处理中"
- 提供下载URL

**测试数据**:
```json
{
  "title": "Monthly Email Analysis Report",
  "type": "email_analysis",
  "date_range": {
    "start_date": "2024-08-01",
    "end_date": "2024-08-31"
  },
  "filters": {
    "sender_domains": ["company.com"],
    "sentiment": ["positive", "neutral"],
    "priority": ["high", "medium"]
  },
  "format": "pdf",
  "include_charts": true
}
```

---

### TC-REPORT-002: 下载完成的PDF报告
**优先级**: P0  
**测试类型**: 功能测试  
**前置条件**: 报告已生成完成  

**测试步骤**:
1. 获取已完成报告的ID
2. 发送下载请求
3. 验证响应头信息
4. 验证文件内容

**预期结果**:
- 返回200状态码
- Content-Type为application/pdf
- Content-Disposition包含attachment
- PDF文件格式正确
- 文件大小 > 1000字节
- 文件以%PDF开头

---

### TC-REPORT-003: 下载Excel格式报告
**优先级**: P1  
**测试类型**: 功能测试  
**前置条件**: Excel格式报告已生成完成  

**测试步骤**:
1. 下载Excel格式报告
2. 验证文件格式
3. 使用Excel读取工具验证内容

**预期结果**:
- Content-Type正确
- Excel文件可正常打开
- 包含有效数据
- 工作表结构合理

---

### TC-REPORT-004: 创建定时报告
**优先级**: P1  
**测试类型**: 功能测试  
**前置条件**: 用户有定时报告权限  

**测试步骤**:
1. 创建周报配置
2. 设置执行时间: 每周一09:00
3. 设置滚动日期范围: 7天
4. 配置收件人列表
5. 启用自动发送

**预期结果**:
- 定时报告创建成功
- 计算下次执行时间
- 调度器正确配置
- 收件人信息保存

**测试数据**:
```json
{
  "title": "Weekly Email Analysis",
  "schedule": {
    "frequency": "weekly",
    "day_of_week": 1,
    "time": "09:00"
  },
  "rolling_days": 7,
  "recipients": ["manager@company.com"],
  "auto_send": true
}
```

---

### TC-REPORT-005: 暂停和恢复定时报告
**优先级**: P2  
**测试类型**: 功能测试  
**前置条件**: 存在活跃的定时报告  

**测试步骤**:
1. 获取活跃定时报告ID
2. 发送暂停请求
3. 验证状态更新
4. 发送恢复请求
5. 验证状态恢复

**预期结果**:
- 暂停操作成功，is_active设为false
- 恢复操作成功，is_active设为true
- 状态变更实时生效
- 调度器正确更新

---

### TC-REPORT-006: 报告模板功能
**优先级**: P2  
**测试类型**: 功能测试  
**前置条件**: 系统预置报告模板  

**测试步骤**:
1. 获取报告模板列表
2. 选择特定模板
3. 基于模板创建报告
4. 自定义模板配置

**预期结果**:
- 模板列表正确返回
- 模板包含默认配置
- 基于模板的报告创建成功
- 自定义配置生效

---

## 邮件过滤规则测试用例

### TC-FILTER-001: 创建基于发件人的过滤规则
**优先级**: P1  
**测试类型**: 功能测试  
**前置条件**: 用户有过滤规则管理权限  

**测试步骤**:
1. 导航到过滤规则页面
2. 点击"新建规则"
3. 设置规则名称: "VIP客户邮件"
4. 设置条件: 发件人包含"@vip-client.com"
5. 设置动作: 标记为高优先级
6. 保存规则

**预期结果**:
- 规则创建成功
- 规则状态为启用
- 规则应用到新邮件
- 匹配邮件正确处理

---

### TC-FILTER-002: 基于关键词的过滤规则
**优先级**: P1  
**测试类型**: 功能测试  
**前置条件**: 用户有规则创建权限  

**测试步骤**:
1. 创建关键词过滤规则
2. 设置关键词: "紧急", "URGENT", "立即"
3. 设置动作: 发送通知 + 高优先级标记
4. 测试规则匹配

**预期结果**:
- 包含关键词的邮件被正确识别
- 执行相应动作
- 通知正确发送
- 优先级正确设置

---

### TC-FILTER-003: 规则优先级处理
**优先级**: P2  
**测试类型**: 功能测试  
**前置条件**: 存在多个过滤规则  

**测试步骤**:
1. 创建多个有冲突的规则
2. 设置不同优先级
3. 测试邮件匹配多个规则时的处理

**预期结果**:
- 高优先级规则先执行
- 规则冲突正确解决
- 执行结果符合预期
- 处理日志完整

---

## API集成测试用例

### TC-API-001: 邮件分析API端点测试
**优先级**: P0  
**测试类型**: API测试  
**前置条件**: API服务运行正常，有效认证令牌  

**测试步骤**:
1. 发送POST请求到 `/api/v1/emails/analyze`
2. 包含有效的认证头
3. 请求体包含邮件数据

**预期结果**:
- 返回200状态码
- 响应体包含完整分析结果
- 响应时间 < 5秒
- 数据格式正确

**请求示例**:
```bash
POST /api/v1/emails/analyze
Authorization: Bearer <token>
Content-Type: application/json

{
  "email_content": "测试邮件内容",
  "from": "test@example.com",
  "subject": "测试主题",
  "to": "support@example.com"
}
```

---

### TC-API-002: 批量邮件分析API
**优先级**: P1  
**测试类型**: API测试  
**前置条件**: 有大量邮件数据用于测试  

**测试步骤**:
1. 发送POST请求到 `/api/v1/emails/batch-analyze`
2. 包含邮件数组数据
3. 监控处理进度

**预期结果**:
- 批量处理成功启动
- 返回批次ID
- 处理状态可查询
- 结果准确性验证

---

### TC-API-003: API认证和授权
**优先级**: P0  
**测试类型**: 安全测试  
**前置条件**: 多种用户角色和权限配置  

**测试步骤**:
1. 使用无效token访问API
2. 使用过期token访问API
3. 使用有效但权限不足的token
4. 使用有效且有权限的token

**预期结果**:
- 无效token返回401
- 过期token返回401
- 权限不足返回403
- 有效token返回200

---

### TC-API-004: API速率限制
**优先级**: P1  
**测试类型**: 性能测试  
**前置条件**: API配置了速率限制  

**测试步骤**:
1. 快速连续发送多个API请求
2. 超过速率限制阈值
3. 观察限流响应
4. 等待限制重置后重试

**预期结果**:
- 超过限制时返回429状态码
- 响应包含限流信息
- 限制重置后恢复正常
- 不影响系统稳定性

---

## 性能测试用例

### TC-PERF-001: 邮件分析响应时间测试
**优先级**: P1  
**测试类型**: 性能测试  
**前置条件**: 系统负载正常  

**测试目标**:
- 单个邮件分析 < 2秒 (95th percentile)
- 批量分析启动 < 5秒
- API响应时间 < 200ms (简单查询)

**测试步骤**:
1. 准备不同大小的邮件内容
2. 执行单个邮件分析并记录时间
3. 执行批量分析并记录启动时间
4. 执行API查询并记录响应时间

**预期结果**:
- 95%的请求在目标时间内完成
- 系统资源使用合理
- 无内存泄漏
- 响应时间稳定

---

### TC-PERF-002: 并发用户负载测试
**优先级**: P1  
**测试类型**: 负载测试  
**前置条件**: 测试环境配置完成  

**测试目标**:
- 支持1000并发用户
- 系统响应时间增长 < 50%
- 错误率 < 1%

**测试步骤**:
1. 模拟50个并发用户开始
2. 每30秒增加50用户
3. 达到1000用户后持续10分钟
4. 监控系统指标

**预期结果**:
- 系统稳定处理并发请求
- CPU使用率 < 80%
- 内存使用增长合理
- 数据库连接池正常

---

### TC-PERF-003: 大数据量处理测试
**优先级**: P2  
**测试类型**: 压力测试  
**前置条件**: 准备大量测试数据  

**测试目标**:
- 10万邮件批处理 < 30分钟
- 内存使用 < 2GB
- 数据库查询优化有效

**测试步骤**:
1. 准备10万条邮件测试数据
2. 启动批量分析处理
3. 监控处理进度和系统资源
4. 验证处理结果准确性

**预期结果**:
- 在预期时间内完成处理
- 系统资源使用稳定
- 处理结果准确无误
- 无系统崩溃或异常

---

## 安全测试用例

### TC-SEC-001: SQL注入漏洞测试
**优先级**: P0  
**测试类型**: 安全测试  
**前置条件**: 应用接受用户输入  

**测试步骤**:
1. 在邮件内容字段输入SQL注入payload
2. 在搜索框输入注入代码
3. 在用户名密码字段测试注入
4. 观察系统响应和数据库日志

**测试Payload**:
```sql
' OR '1'='1' --
'; DROP TABLE users; --
' UNION SELECT * FROM users --
```

**预期结果**:
- 所有注入尝试被阻止
- 系统返回安全错误信息
- 数据库数据完整
- 攻击行为被记录

---

### TC-SEC-002: XSS跨站脚本攻击测试
**优先级**: P0  
**测试类型**: 安全测试  
**前置条件**: 应用显示用户输入内容  

**测试步骤**:
1. 在邮件内容中插入脚本代码
2. 在用户资料字段输入脚本
3. 查看内容显示是否执行脚本
4. 测试反射型和存储型XSS

**测试Payload**:
```javascript
<script>alert('XSS')</script>
<img src=x onerror=alert('XSS')>
javascript:alert('XSS')
```

**预期结果**:
- 脚本代码被正确转义
- 不执行恶意JavaScript
- 输出内容安全显示
- XSS攻击被有效防护

---

### TC-SEC-003: 认证安全测试
**优先级**: P0  
**测试类型**: 安全测试  
**前置条件**: 系统使用JWT认证  

**测试步骤**:
1. 测试token篡改检测
2. 测试过期token处理
3. 测试暴力破解保护
4. 测试会话管理安全性

**预期结果**:
- 篡改token被拒绝
- 过期token自动失效
- 多次失败登录被限制
- 会话安全性得到保障

---

### TC-SEC-004: 数据加密验证
**优先级**: P1  
**测试类型**: 安全测试  
**前置条件**: 敏感数据需要加密存储  

**测试步骤**:
1. 检查数据库中密码存储
2. 验证邮件内容加密
3. 检查传输过程加密
4. 验证密钥管理安全性

**预期结果**:
- 密码使用强哈希算法
- 敏感数据加密存储
- HTTPS传输加密
- 密钥安全管理

---

## 可访问性测试用例

### TC-A11Y-001: 键盘导航测试
**优先级**: P2  
**测试类型**: 可访问性测试  
**前置条件**: 页面支持键盘操作  

**测试步骤**:
1. 使用Tab键在页面元素间导航
2. 使用Enter键激活按钮和链接
3. 使用方向键操作列表和菜单
4. 验证焦点指示器可见性

**预期结果**:
- 所有可交互元素可键盘访问
- Tab顺序逻辑合理
- 焦点指示器清晰可见
- 键盘操作符合标准

---

### TC-A11Y-002: 屏幕阅读器兼容性
**优先级**: P2  
**测试类型**: 可访问性测试  
**前置条件**: 安装屏幕阅读器软件  

**测试步骤**:
1. 使用NVDA或JAWS测试页面
2. 验证内容正确朗读
3. 检查ARIA标签和角色
4. 测试表单标签关联

**预期结果**:
- 内容结构清晰朗读
- ARIA标签正确设置
- 表单标签正确关联
- 交互元素状态明确

---

### TC-A11Y-003: 颜色对比度检查
**优先级**: P2  
**测试类型**: 可访问性测试  
**前置条件**: 使用颜色对比度检测工具  

**测试步骤**:
1. 检查文本与背景对比度
2. 验证按钮颜色对比度
3. 检查链接颜色识别度
4. 测试错误信息显示

**预期结果**:
- 对比度达到WCAG AA标准
- 最小对比度比例4.5:1
- 颜色不是唯一信息载体
- 错误信息清晰可辨

---

## 跨浏览器兼容性测试用例

### TC-COMPAT-001: Chrome浏览器兼容性
**优先级**: P1  
**测试类型**: 兼容性测试  
**前置条件**: Chrome最新版本和前两个版本  

**测试步骤**:
1. 在Chrome中访问应用
2. 测试核心功能
3. 验证JavaScript执行
4. 检查CSS样式显示

**预期结果**:
- 所有功能正常工作
- 页面布局正确
- 性能表现良好
- 无控制台错误

---

### TC-COMPAT-002: Firefox浏览器兼容性
**优先级**: P1  
**测试类型**: 兼容性测试  
**前置条件**: Firefox最新版本  

**测试步骤**:
1. 在Firefox中测试应用
2. 对比Chrome中的表现
3. 验证特有功能工作正常
4. 检查性能差异

**预期结果**:
- 功能与Chrome中一致
- 视觉效果基本相同
- 性能差异可接受
- 用户体验良好

---

### TC-COMPAT-003: Safari浏览器兼容性
**优先级**: P2  
**测试类型**: 兼容性测试  
**前置条件**: macOS Safari浏览器  

**测试步骤**:
1. 在Safari中测试核心功能
2. 验证Webkit特有行为
3. 检查字体和布局差异
4. 测试移动Safari兼容性

**预期结果**:
- 基本功能正常工作
- 布局适应Safari特性
- 移动版体验良好
- 性能表现稳定

---

### TC-COMPAT-004: 移动设备响应式测试
**优先级**: P1  
**测试类型**: 响应式测试  
**前置条件**: 多种屏幕尺寸设备  

**测试步骤**:
1. 在iPhone上测试应用
2. 在Android设备上测试
3. 在平板设备上测试
4. 测试不同方向显示

**预期结果**:
- 移动端布局合适
- 触摸操作友好
- 文字大小合适
- 性能流畅稳定

---

## 测试执行优先级

### P0 - 关键功能 (阻塞性)
- 用户注册登录 (TC-AUTH-001, TC-AUTH-003)
- 邮件分析核心功能 (TC-EMAIL-001, TC-EMAIL-002)
- 报告生成基本功能 (TC-REPORT-001, TC-REPORT-002)
- API核心端点 (TC-API-001)
- 安全基础测试 (TC-SEC-001, TC-SEC-002)

### P1 - 重要功能
- 认证边界情况 (TC-AUTH-002, TC-AUTH-004)
- 邮件分析扩展功能 (TC-EMAIL-003, TC-EMAIL-005)
- 报告高级功能 (TC-REPORT-003, TC-REPORT-004)
- 性能基础测试 (TC-PERF-001, TC-PERF-002)
- 浏览器兼容性 (TC-COMPAT-001, TC-COMPAT-002)

### P2 - 增强功能
- 多语言支持 (TC-EMAIL-004)
- 历史记录功能 (TC-EMAIL-006)
- 定时报告管理 (TC-REPORT-005)
- 可访问性测试 (TC-A11Y-001, TC-A11Y-002)
- Safari兼容性 (TC-COMPAT-003)

---

## 测试环境要求

### 硬件配置
- CPU: 4核心以上
- 内存: 8GB以上
- 磁盘: 100GB可用空间
- 网络: 稳定的互联网连接

### 软件依赖
- Node.js 18+
- Python 3.9+
- PostgreSQL 13+
- Redis 6+
- Docker & Docker Compose

### 浏览器要求
- Chrome 90+
- Firefox 88+
- Safari 14+ (macOS)
- Edge 90+

---

## 测试数据管理

### 测试数据类别
1. **静态测试数据**: 预定义的用户账户、邮件模板
2. **动态测试数据**: 测试执行时生成的随机数据
3. **Mock数据**: API响应和外部服务的模拟数据

### 数据清理策略
- 每次测试执行前重置测试数据库
- 测试完成后清理临时文件
- 定期清理测试日志和报告

---

## 缺陷报告模板

### 缺陷标题格式
```
[模块] 简短描述 - 环境
示例: [邮件分析] 情感分析结果错误 - Chrome浏览器
```

### 缺陷详情
- **测试用例ID**: TC-XXX-XXX
- **严重程度**: P0/P1/P2/P3
- **测试环境**: 浏览器版本、操作系统
- **重现步骤**: 详细步骤描述
- **预期结果**: 应该发生的情况
- **实际结果**: 实际观察到的情况
- **附件**: 截图、日志文件

---

*本文档将根据项目进展和反馈持续更新。所有测试用例应该与自动化测试脚本保持同步。*