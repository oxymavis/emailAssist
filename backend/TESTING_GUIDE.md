# Email Assist åç«¯APIæµ‹è¯•å¥—ä»¶ - å®Œæ•´æŒ‡å—

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

æˆ‘å·²ç»ä¸ºEmail Assisté¡¹ç›®åˆ›å»ºäº†ä¸€ä¸ªå…¨é¢çš„åç«¯APIåŠŸèƒ½æµ‹è¯•å¥—ä»¶ï¼Œæ¶µç›–äº†æ‰€æœ‰ä¸»è¦æ¨¡å—çš„æµ‹è¯•ç”¨ä¾‹ã€‚ä»¥ä¸‹æ˜¯å®Œæ•´çš„æµ‹è¯•æ¡†æ¶è¯´æ˜å’Œä½¿ç”¨æŒ‡å—ã€‚

## ğŸ¯ æµ‹è¯•è¦†ç›–èŒƒå›´

### âœ… å·²å®Œæˆçš„æµ‹è¯•æ¨¡å—

1. **ç”¨æˆ·è®¤è¯å’Œæˆæƒç³»ç»Ÿ**
   - ç”¨æˆ·æ³¨å†Œã€ç™»å½•ã€æ³¨é”€
   - JWTä»¤ç‰Œç®¡ç†å’Œåˆ·æ–°
   - å¯†ç é‡ç½®å’Œä¿®æ”¹
   - Microsoft OAuth2é›†æˆ

2. **é‚®ä»¶ç®¡ç†API**
   - é‚®ä»¶CRUDæ“ä½œ (å¢åˆ æ”¹æŸ¥)
   - é‚®ä»¶æœç´¢å’Œè¿‡æ»¤
   - é‚®ä»¶æ ‡ç­¾å’Œåˆ†ç±»
   - æ‰¹é‡æ“ä½œ

3. **AIåˆ†æåŠŸèƒ½API**
   - é‚®ä»¶æƒ…æ„Ÿåˆ†æ
   - ä¼˜å…ˆçº§è¯„ä¼°
   - å†…å®¹åˆ†ç±»å’Œå…³é”®è¯æå–
   - æ‰¹é‡åˆ†æå¤„ç†

4. **è¿‡æ»¤è§„åˆ™API**
   - è§„åˆ™åˆ›å»ºã€ä¿®æ”¹ã€åˆ é™¤
   - è§„åˆ™æ‰§è¡Œå¼•æ“æµ‹è¯•
   - è§„åˆ™æ€§èƒ½ç›‘æ§
   - å¤æ‚æ¡ä»¶é€»è¾‘æµ‹è¯•

5. **æŠ¥å‘Šç”ŸæˆAPI**
   - æŠ¥å‘Šæ¨¡æ¿ç®¡ç†
   - æŠ¥å‘Šç”Ÿæˆå’Œå¯¼å‡º (PDF/Excel/CSV)
   - å®šæ—¶æŠ¥å‘Šä»»åŠ¡
   - æŠ¥å‘Šæ•°æ®ç»Ÿè®¡

6. **ç›‘æ§å’Œæ€§èƒ½API**
   - ç³»ç»Ÿå¥åº·æ£€æŸ¥
   - æ€§èƒ½æŒ‡æ ‡ç›‘æ§
   - ç¼“å­˜ç®¡ç†
   - æ•°æ®åº“æ€§èƒ½ç›‘æ§

## ğŸ“ æ–‡ä»¶ç»“æ„

```
backend/tests/
â”œâ”€â”€ ğŸ“„ API_TEST_CASES.md          # è¯¦ç»†æµ‹è¯•ç”¨ä¾‹æ–‡æ¡£ (400+ æµ‹è¯•ç”¨ä¾‹)
â”œâ”€â”€ ğŸ“„ README.md                  # ä½¿ç”¨æŒ‡å—
â”œâ”€â”€ ğŸ“„ conftest.py                # Pytesté…ç½®å’Œå…¨å±€fixtures
â”œâ”€â”€ ğŸ“„ pytest.ini                 # Pytestè®¾ç½®
â”œâ”€â”€ ğŸ“„ requirements.txt            # æµ‹è¯•ä¾èµ–åŒ…
â”œâ”€â”€ ğŸ“„ run_tests.py               # ä¸»æµ‹è¯•è¿è¡Œå™¨ â­
â”œâ”€â”€ ğŸ“„ validate_setup.py          # ç¯å¢ƒéªŒè¯è„šæœ¬ â­
â”œâ”€â”€ ğŸ“ fixtures/
â”‚   â””â”€â”€ ğŸ“„ test_data.py           # æµ‹è¯•æ•°æ®ç”Ÿæˆå™¨ (å®Œæ•´æ•°æ®ç”Ÿæˆ)
â”œâ”€â”€ ğŸ“ utils/
â”‚   â”œâ”€â”€ ğŸ“„ database_setup.py      # æµ‹è¯•æ•°æ®åº“ç®¡ç†
â”‚   â””â”€â”€ ğŸ“„ mock_services.py       # Mockå¤–éƒ¨æœåŠ¡ (OpenAI/Microsoft Graph)
â”œâ”€â”€ ğŸ“ integration/               # é›†æˆæµ‹è¯• â­
â”‚   â”œâ”€â”€ ğŸ“„ test_auth_api.py       # è®¤è¯APIæµ‹è¯• (50+ æµ‹è¯•ç”¨ä¾‹)
â”‚   â”œâ”€â”€ ğŸ“„ test_email_api.py      # é‚®ä»¶APIæµ‹è¯• (60+ æµ‹è¯•ç”¨ä¾‹)
â”‚   â”œâ”€â”€ ğŸ“„ test_analysis_api.py   # AIåˆ†æAPIæµ‹è¯• (40+ æµ‹è¯•ç”¨ä¾‹)
â”‚   â”œâ”€â”€ ğŸ“„ test_rules_api.py      # è§„åˆ™APIæµ‹è¯• (35+ æµ‹è¯•ç”¨ä¾‹)
â”‚   â”œâ”€â”€ ğŸ“„ test_reports_api.py    # æŠ¥å‘ŠAPIæµ‹è¯• (45+ æµ‹è¯•ç”¨ä¾‹)
â”‚   â””â”€â”€ ğŸ“„ test_monitoring_api.py # ç›‘æ§APIæµ‹è¯• (30+ æµ‹è¯•ç”¨ä¾‹)
â”œâ”€â”€ ğŸ“ unit/                      # å•å…ƒæµ‹è¯•ç›®å½•
â”œâ”€â”€ ğŸ“ performance/               # æ€§èƒ½æµ‹è¯•ç›®å½•
â”œâ”€â”€ ğŸ“ security/                  # å®‰å…¨æµ‹è¯•ç›®å½•
â””â”€â”€ ğŸ“ reports/                   # æµ‹è¯•æŠ¥å‘Šè¾“å‡º
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒéªŒè¯
```bash
cd /Users/shelia/Desktop/01_Unis/05_Cursor/0908/backend/tests
python3 validate_setup.py
```

### 2. å®‰è£…ä¾èµ–
```bash
pip install -r requirements.txt
```

### 3. é…ç½®ç¯å¢ƒ
å¤åˆ¶å¹¶ç¼–è¾‘é…ç½®æ–‡ä»¶ï¼š
```bash
cp .env.test.example .env.test
# ç¼–è¾‘ .env.test è®¾ç½®æ•°æ®åº“å’ŒAPIè¿æ¥ä¿¡æ¯
```

### 4. å¯åŠ¨åç«¯æœåŠ¡
```bash
cd ..
npm run dev
```

### 5. è¿è¡Œæµ‹è¯•
```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
python3 run_tests.py

# è¿è¡Œç‰¹å®šæ¨¡å—æµ‹è¯•
python3 run_tests.py integration/test_auth_api.py
python3 run_tests.py integration/test_email_api.py

# è¿è¡Œç‰¹å®šç±»å‹æµ‹è¯•
python3 run_tests.py --integration
python3 run_tests.py --performance
```

## ğŸ§ª ä¸»è¦æµ‹è¯•åŠŸèƒ½

### 1. è‡ªåŠ¨åŒ–æ•°æ®åº“ç®¡ç†
- è‡ªåŠ¨åˆ›å»ºæµ‹è¯•æ•°æ®åº“
- å®Œæ•´çš„æ•°æ®åº“æ¨¡å¼åˆ›å»º
- æ¯ä¸ªæµ‹è¯•ä½¿ç”¨ç‹¬ç«‹äº‹åŠ¡
- æµ‹è¯•ç»“æŸåè‡ªåŠ¨æ¸…ç†

### 2. æ™ºèƒ½MockæœåŠ¡
- **OpenAI API Mock**: æ™ºèƒ½åˆ†æå“åº”
- **Microsoft Graph API Mock**: OAuthå’Œé‚®ä»¶åŒæ­¥
- **Gmail API Mock**: Gmailé›†æˆæµ‹è¯•
- **SMTP/IMAP Mock**: é‚®ä»¶æ”¶å‘æµ‹è¯•

### 3. ä¸°å¯Œçš„æµ‹è¯•æ•°æ®
- ä½¿ç”¨Fakerç”ŸæˆçœŸå®æµ‹è¯•æ•°æ®
- æ”¯æŒç”Ÿæˆå®Œæ•´ç”¨æˆ·æ•°æ®é›†
- é¢„å®šä¹‰è¾¹ç•Œæµ‹è¯•ç”¨ä¾‹
- å¯è‡ªå®šä¹‰æ•°æ®ç‰¹å¾

### 4. å…¨é¢çš„æŠ¥å‘Šç³»ç»Ÿ
- HTMLäº¤äº’å¼æµ‹è¯•æŠ¥å‘Š
- ä»£ç è¦†ç›–ç‡æŠ¥å‘Š
- JSONæ ¼å¼æœºå™¨å¯è¯»æŠ¥å‘Š
- æ€§èƒ½å’Œé”™è¯¯ç»Ÿè®¡

## ğŸ“Š æµ‹è¯•ç»Ÿè®¡

| æ¨¡å— | æµ‹è¯•ç±»æ•°é‡ | æµ‹è¯•ç”¨ä¾‹æ•°é‡ | è¦†ç›–åœºæ™¯ |
|------|------------|--------------|----------|
| è®¤è¯API | 6 | 50+ | æ³¨å†Œ/ç™»å½•/JWT/OAuth |
| é‚®ä»¶API | 7 | 60+ | CRUD/æœç´¢/æ ‡ç­¾/æ‰¹é‡ |
| åˆ†æAPI | 5 | 40+ | æƒ…æ„Ÿ/ä¼˜å…ˆçº§/åˆ†ç±»/å…³é”®è¯ |
| è§„åˆ™API | 4 | 35+ | CRUD/æ‰§è¡Œ/ç›‘æ§/æ€§èƒ½ |
| æŠ¥å‘ŠAPI | 4 | 45+ | æ¨¡æ¿/ç”Ÿæˆ/å¯¼å‡º/è°ƒåº¦ |
| ç›‘æ§API | 5 | 30+ | å¥åº·/æ€§èƒ½/ç¼“å­˜/å‘Šè­¦ |
| **æ€»è®¡** | **31** | **260+** | **å…¨è¦†ç›–** |

## ğŸ”§ é«˜çº§åŠŸèƒ½

### 1. å¹¶è¡Œæµ‹è¯•æ‰§è¡Œ
```bash
# ä½¿ç”¨å¤šè¿›ç¨‹å¹¶è¡Œè¿è¡Œ
python3 run_tests.py -n 4
```

### 2. æµ‹è¯•æ ‡è®°å’Œç­›é€‰
```bash
# è¿è¡ŒAPIç›¸å…³æµ‹è¯•
python3 run_tests.py -m api

# è¿è¡Œè®¤è¯ç›¸å…³æµ‹è¯•
python3 run_tests.py -m auth

# ç»„åˆæ ‡è®°
python3 run_tests.py -m "api and email"
```

### 3. è¦†ç›–ç‡æ§åˆ¶
```bash
# è®¾ç½®æœ€ä½è¦†ç›–ç‡è¦æ±‚
python3 run_tests.py --cov-fail-under=80

# ç”Ÿæˆè¯¦ç»†è¦†ç›–ç‡æŠ¥å‘Š
python3 run_tests.py --report-dir=detailed_reports
```

### 4. æ€§èƒ½æµ‹è¯•
```bash
# è¿è¡Œæ€§èƒ½æµ‹è¯•
python3 run_tests.py --performance

# å¹¶å‘æµ‹è¯•
python3 run_tests.py -m "performance and slow"
```

## ğŸ” æµ‹è¯•ç”¨ä¾‹ç¤ºä¾‹

### è®¤è¯æµ‹è¯•ç¤ºä¾‹
```python
def test_successful_registration(self, api_client, api_base_url, clean_database):
    """æµ‹è¯•ç”¨æˆ·æˆåŠŸæ³¨å†Œ"""
    registration_data = {
        "email": "newuser@example.com",
        "password": "Password123!",
        "confirmPassword": "Password123!",
        "name": "New Test User"
    }
    
    response = api_client.post(f"{api_base_url}/auth/register", json=registration_data)
    
    assert response.status_code == 201
    data = response.json()
    assert data["success"] is True
    assert "token" in data["data"]
    assert "user" in data["data"]
```

### é‚®ä»¶APIæµ‹è¯•ç¤ºä¾‹
```python
def test_get_email_list_with_pagination(self, api_client, api_base_url, seed_test_emails):
    """æµ‹è¯•é‚®ä»¶åˆ—è¡¨åˆ†é¡µåŠŸèƒ½"""
    response = api_client.get(
        f"{api_base_url}/email/messages?page=1&limit=10",
        headers=self.auth_headers
    )
    
    assert response.status_code == 200
    data = response.json()
    assert len(data["data"]) <= 10
    assert "meta" in data  # åˆ†é¡µå…ƒæ•°æ®
```

### AIåˆ†ææµ‹è¯•ç¤ºä¾‹
```python
def test_single_email_sentiment_analysis(self, api_client, api_base_url, mock_openai):
    """æµ‹è¯•å•å°é‚®ä»¶æƒ…æ„Ÿåˆ†æ"""
    analysis_data = {
        "messageId": "msg123",
        "content": "I am very happy with the excellent service!"
    }
    
    response = api_client.post(f"{api_base_url}/analysis/sentiment", json=analysis_data, headers=self.auth_headers)
    
    assert response.status_code == 200
    data = response.json()
    assert data["data"]["sentiment"] in ["positive", "negative", "neutral"]
    assert 0.0 <= data["data"]["confidence"] <= 1.0
```

## ğŸ“ˆ æ€§èƒ½åŸºå‡†

### APIå“åº”æ—¶é—´ç›®æ ‡
- è®¤è¯API: < 500ms
- é‚®ä»¶æŸ¥è¯¢: < 1s  
- AIåˆ†æ: < 2s
- æŠ¥å‘Šç”Ÿæˆ: < 10s

### å¹¶å‘æ€§èƒ½ç›®æ ‡
- æ”¯æŒ100ä¸ªå¹¶å‘ç”¨æˆ·
- é”™è¯¯ç‡ < 1%
- 95%è¯·æ±‚å“åº”æ—¶é—´ < 2s

## ğŸ” å®‰å…¨æµ‹è¯•

### å·²åŒ…å«çš„å®‰å…¨æµ‹è¯•
1. **è®¤è¯ç»•è¿‡æµ‹è¯•**: æµ‹è¯•æœªè®¤è¯è®¿é—®ä¿æŠ¤
2. **æƒé™æ£€æŸ¥æµ‹è¯•**: ç¡®ä¿ç”¨æˆ·åªèƒ½è®¿é—®è‡ªå·±çš„æ•°æ®
3. **è¾“å…¥éªŒè¯æµ‹è¯•**: é˜²æ­¢æ¶æ„è¾“å…¥
4. **JWTå®‰å…¨æµ‹è¯•**: ä»¤ç‰Œç¯¡æ”¹å’Œè¿‡æœŸæ£€æµ‹
5. **Rate Limitingæµ‹è¯•**: é˜²æŠ¤æš´åŠ›æ”»å‡»

## ğŸ¤– MockæœåŠ¡è¯¦æƒ…

### OpenAI API Mock
- æ™ºèƒ½æƒ…æ„Ÿåˆ†æå“åº”
- åŸºäºå†…å®¹çš„ä¼˜å…ˆçº§è¯„ä¼°
- å…³é”®è¯æå–æ¨¡æ‹Ÿ
- æ”¯æŒæ‰¹é‡åˆ†æ

### Microsoft Graph API Mock
- OAuthè®¤è¯æµç¨‹æ¨¡æ‹Ÿ
- é‚®ä»¶åŒæ­¥æ•°æ®ç”Ÿæˆ
- ç”¨æˆ·ä¿¡æ¯æ¨¡æ‹Ÿ
- é”™è¯¯åœºæ™¯å¤„ç†

## ğŸ›ï¸ é…ç½®é€‰é¡¹

### ç¯å¢ƒå˜é‡é…ç½®
```bash
# æ•°æ®åº“
TEST_DB_URL=postgresql://postgres:password@localhost:5432/email_assist_test

# Redis
TEST_REDIS_URL=redis://localhost:6379/1

# APIæœåŠ¡
API_BASE_URL=http://localhost:3001/api

# æµ‹è¯•è¡Œä¸º
SEED_TEST_DATA=true
USE_MOCK_SERVICES=true
TEST_TIMEOUT=30
```

### æµ‹è¯•è¿è¡Œé€‰é¡¹
```bash
# è¯¦ç»†è¾“å‡º
python3 run_tests.py -vv

# åœåœ¨ç¬¬ä¸€ä¸ªå¤±è´¥
python3 run_tests.py -x

# ç¦ç”¨MockæœåŠ¡ï¼ˆä½¿ç”¨çœŸå®æœåŠ¡ï¼‰
python3 run_tests.py --no-mock

# è·³è¿‡ç¯å¢ƒè®¾ç½®
python3 run_tests.py --no-setup
```

## ğŸ“‹ ä½¿ç”¨æ£€æŸ¥æ¸…å•

### è¿è¡Œæµ‹è¯•å‰æ£€æŸ¥
- [ ] åç«¯æœåŠ¡æ­£åœ¨è¿è¡Œ (`npm run dev`)
- [ ] PostgreSQLæ•°æ®åº“å¯è®¿é—®
- [ ] RedisæœåŠ¡å¯è®¿é—®ï¼ˆå¯é€‰ï¼‰
- [ ] å®‰è£…äº†æ‰€æœ‰Pythonä¾èµ–
- [ ] ç¯å¢ƒå˜é‡å·²é…ç½®

### æµ‹è¯•æ‰§è¡Œæ£€æŸ¥
- [ ] è¿è¡Œç¯å¢ƒéªŒè¯ (`python3 validate_setup.py`)
- [ ] æ‰§è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶ (`python3 run_tests.py`)
- [ ] æ£€æŸ¥æµ‹è¯•è¦†ç›–ç‡ (ç›®æ ‡ > 80%)
- [ ] æŸ¥çœ‹ç”Ÿæˆçš„æµ‹è¯•æŠ¥å‘Š
- [ ] éªŒè¯æ€§èƒ½åŸºå‡†è¾¾æ ‡

## ğŸš¨ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **æ•°æ®åº“è¿æ¥å¤±è´¥**
   ```bash
   # æ£€æŸ¥PostgreSQLçŠ¶æ€
   brew services list | grep postgresql
   # æˆ–
   sudo systemctl status postgresql
   ```

2. **APIæœåŠ¡ä¸å¯è¾¾**
   ```bash
   # æ£€æŸ¥åç«¯æœåŠ¡
   curl http://localhost:3001/health
   ```

3. **ä¾èµ–åŒ…ç¼ºå¤±**
   ```bash
   pip install -r requirements.txt
   ```

4. **æµ‹è¯•æ•°æ®é—®é¢˜**
   ```bash
   # é‡ç½®æµ‹è¯•ç¯å¢ƒ
   python3 run_tests.py --no-seed --no-teardown
   ```

## ğŸ”® æœªæ¥æ‰©å±•

### è®¡åˆ’æ·»åŠ çš„åŠŸèƒ½
1. **æ›´å¤šæµ‹è¯•ç±»å‹**
   - ç«¯åˆ°ç«¯æµ‹è¯•
   - å‹åŠ›æµ‹è¯•
   - å¯é æ€§æµ‹è¯•

2. **å¢å¼ºçš„æŠ¥å‘Š**
   - è¶‹åŠ¿åˆ†æ
   - æ€§èƒ½åŸºå‡†æ¯”è¾ƒ
   - è‡ªåŠ¨åŒ–è´¨é‡é—¨ç¦

3. **CI/CDé›†æˆ**
   - GitHub Actionsé…ç½®
   - è‡ªåŠ¨åŒ–æµ‹è¯•æµæ°´çº¿
   - è´¨é‡æ£€æŸ¥æŠ¥å‘Š

## ğŸ“ æ”¯æŒå’Œç»´æŠ¤

### æµ‹è¯•ç»´æŠ¤
- å®šæœŸæ›´æ–°æµ‹è¯•æ•°æ®
- æ ¹æ®APIå˜åŒ–è°ƒæ•´æµ‹è¯•ç”¨ä¾‹
- ç›‘æ§æµ‹è¯•æ‰§è¡Œæ€§èƒ½
- æ›´æ–°MockæœåŠ¡å“åº”

### è´¡çŒ®æŒ‡å—
1. åœ¨ç›¸åº”ç›®å½•æ·»åŠ æ–°æµ‹è¯•
2. ä½¿ç”¨æè¿°æ€§çš„æµ‹è¯•åç§°
3. æ·»åŠ è¯¦ç»†çš„æ–‡æ¡£å­—ç¬¦ä¸²
4. ç¡®ä¿æµ‹è¯•ç‹¬ç«‹ä¸”å¯é‡å¤
5. æ›´æ–°ç›¸å…³æ–‡æ¡£

---

## ğŸ“ æ€»ç»“

è¿™ä¸ªæµ‹è¯•å¥—ä»¶ä¸ºEmail Assisté¡¹ç›®æä¾›äº†ï¼š

âœ… **å…¨é¢è¦†ç›–**: 260+ ä¸ªæµ‹è¯•ç”¨ä¾‹è¦†ç›–æ‰€æœ‰ä¸»è¦åŠŸèƒ½  
âœ… **è‡ªåŠ¨åŒ–**: ä¸€é”®è¿è¡Œã€è‡ªåŠ¨ç¯å¢ƒç®¡ç†ã€æ™ºèƒ½æ•°æ®ç”Ÿæˆ  
âœ… **ä¸“ä¸šçº§**: MockæœåŠ¡ã€æ€§èƒ½æµ‹è¯•ã€å®‰å…¨æ£€æŸ¥ã€è¯¦ç»†æŠ¥å‘Š  
âœ… **æ˜“äºä½¿ç”¨**: æ¸…æ™°çš„æ–‡æ¡£ã€éªŒè¯è„šæœ¬ã€æ•…éšœæ’é™¤æŒ‡å—  
âœ… **å¯æ‰©å±•**: æ¨¡å—åŒ–è®¾è®¡ã€æ”¯æŒå¹¶è¡Œæ‰§è¡Œã€æ˜“äºç»´æŠ¤  

ç°åœ¨ä½ å¯ä»¥ï¼š
1. åœ¨å‰åç«¯è”è°ƒå‰å•ç‹¬éªŒè¯æ‰€æœ‰åç«¯åŠŸèƒ½
2. ç¡®ä¿APIçš„ç¨³å®šæ€§å’Œå¯é æ€§
3. ç›‘æ§ç³»ç»Ÿæ€§èƒ½å’Œå®‰å…¨æ€§
4. ä¸ºæŒç»­é›†æˆåšå¥½å‡†å¤‡

å‡†å¤‡å¥½å¼€å§‹æµ‹è¯•äº†å—ï¼Ÿè¿è¡Œ `python3 validate_setup.py` å¼€å§‹éªŒè¯ä½ çš„ç¯å¢ƒï¼